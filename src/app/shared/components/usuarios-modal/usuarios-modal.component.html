<div class="usuarios-modal">
  <!-- Header del modal -->
  <div mat-dialog-title class="modal-header">
    <div class="header-content">
      <mat-icon class="modal-icon">{{getModalIcon()}}</mat-icon>
      <h2>{{getModalTitle()}}</h2>
    </div>
    <button mat-icon-button (click)="close()" class="close-button" [disabled]="loading">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Contenido del modal -->
  <mat-dialog-content class="modal-content">
    <!-- Estado de loading global -->
    @if (loading && (data.mode === 'create' || data.mode === 'edit')) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>{{getLoadingMessage()}}</p>
      </div>
    }

    <!-- Formulario de usuarios -->
    @if (!loading || data.mode === 'login' || data.mode === 'register') {
      <app-usuarios-form
        [tipo]="mapFormMode(currentMode)"
        [usuario]="usuarioParaFormulario"
        [usuarioLogueado]="data.currentUser"
        [loading]="loading"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="close()"
        (modeChange)="onModeChange($event)">
      </app-usuarios-form>
    }
  </mat-dialog-content>

  <!-- Footer opcional -->
  @if (showFooter()) {
    <mat-dialog-actions class="modal-footer">
      <div class="footer-content">
        <p class="footer-text">{{getFooterText()}}</p>
        @if (data.mode === 'login' || data.mode === 'register') {
          <div class="footer-actions">
            @if (data.mode === 'login') {
              <button 
                mat-button 
                color="primary" 
                (click)="switchMode('register')"
                [disabled]="loading">
                ¿No tienes cuenta? Regístrate
              </button>
            }
            
            @if (data.mode === 'register') {
              <button 
                mat-button 
                color="primary" 
                (click)="switchMode('login')"
                [disabled]="loading">
                ¿Ya tienes cuenta? Inicia sesión
              </button>
            }
          </div>
        }
      </div>
    </mat-dialog-actions>
  }
</div>
