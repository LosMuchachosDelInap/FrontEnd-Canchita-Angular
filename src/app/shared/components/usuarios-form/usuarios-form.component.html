<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <!-- Campos para login -->
  @if (tipo === 'sign-in') {
    <div class="form-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="tu@email.com">
        <mat-icon matSuffix>email</mat-icon>
        @if (form.get('email')?.hasError('required')) {
          <mat-error>El email es requerido</mat-error>
        }
        @if (form.get('email')?.hasError('email')) {
          <mat-error>Ingrese un email válido</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Contraseña</mat-label>
        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" placeholder="Contraseña">
        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (form.get('password')?.hasError('required')) {
          <mat-error>La contraseña es requerida</mat-error>
        }
      </mat-form-field>
    </div>
  }

  <!-- Campos para registro y crear/editar usuario -->
  @if (tipo === 'sign-up' || tipo === 'editar' || tipo === 'detalle') {
    <div class="form-section">
      <!-- Nombre y Apellido -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" placeholder="Nombre">
          <mat-icon matSuffix>person</mat-icon>
          @if (form.get('nombre')?.hasError('required')) {
            <mat-error>El nombre es requerido</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Apellido</mat-label>
          <input matInput formControlName="apellido" placeholder="Apellido">
          <mat-icon matSuffix>person</mat-icon>
          @if (form.get('apellido')?.hasError('required')) {
            <mat-error>El apellido es requerido</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Email -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="tu@email.com">
        <mat-icon matSuffix>email</mat-icon>
        @if (form.get('email')?.hasError('required')) {
          <mat-error>El email es requerido</mat-error>
        }
        @if (form.get('email')?.hasError('email')) {
          <mat-error>Ingrese un email válido</mat-error>
        }
      </mat-form-field>

      <!-- Contraseña -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Contraseña</mat-label>
        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" placeholder="Contraseña">
        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (form.get('password')?.hasError('required')) {
          <mat-error>La contraseña es requerida</mat-error>
        }
        @if (form.get('password')?.hasError('minlength')) {
          <mat-error>La contraseña debe tener al menos 6 caracteres</mat-error>
        }
      </mat-form-field>

      <!-- Datos adicionales (opcional para registro) -->
      @if (tipo === 'editar') {
        <div class="form-section">
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Edad</mat-label>
              <input matInput type="number" formControlName="edad" placeholder="Edad">
              <mat-icon matSuffix>cake</mat-icon>
              @if (form.get('edad')?.hasError('min')) {
                <mat-error>La edad debe ser mayor a 0</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>DNI</mat-label>
              <input matInput formControlName="dni" placeholder="12345678">
              <mat-icon matSuffix>badge</mat-icon>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Teléfono</mat-label>
            <input matInput formControlName="telefono" placeholder="11 1234-5678">
            <mat-icon matSuffix>phone</mat-icon>
          </mat-form-field>

          <!-- Rol (solo para administradores) -->
          @if (canSelectRole) {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Rol</mat-label>
              <mat-select formControlName="rol">
                @for (role of availableRoles; track role.value) {
                  <mat-option [value]="role.value">
                    {{role.label}}
                  </mat-option>
                }
              </mat-select>
              <mat-icon matSuffix>admin_panel_settings</mat-icon>
              @if (form.get('rol')?.hasError('required')) {
                <mat-error>Seleccione un rol</mat-error>
              }
            </mat-form-field>
          }
        </div>
      }
    </div>
  }

  <!-- Botones de acción -->
  <div class="form-actions">
    <button 
      mat-button 
      type="button" 
      (click)="onCancel()"
      [disabled]="loading">
      Cancelar
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      type="submit"
      [disabled]="form.invalid || loading">
      
      @if (loading) {
        <ng-container>
          <mat-icon>refresh</mat-icon>
          <span>{{getLoadingText()}}</span>
        </ng-container>
      }
      @else {
        <span>{{getSubmitButtonText()}}</span>
      }
    </button>
  </div>

  <!-- Información adicional -->
  @if (tipo === 'sign-in') {
    <div class="additional-info">
      <p>¿No tienes cuenta? 
        <button mat-button color="primary" type="button" (click)="switchToRegister()">
          Regístrate aquí
        </button>
      </p>
    </div>
  }

  @if (tipo === 'sign-up') {
    <div class="additional-info">
      <p>¿Ya tienes cuenta? 
        <button mat-button color="primary" type="button" (click)="switchToLogin()">
          Inicia sesión
        </button>
      </p>
    </div>
  }
</form>
