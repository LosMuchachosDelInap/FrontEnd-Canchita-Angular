<form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="usuarios-form">
  <!-- Campos para login -->
  <div *ngIf="mode === 'login'" class="form-section">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Email</mat-label>
      <input matInput type="email" formControlName="email" placeholder="tu@email.com">
      <mat-icon matSuffix>email</mat-icon>
      <mat-error *ngIf="userForm.get('email')?.hasError('required')">
        El email es requerido
      </mat-error>
      <mat-error *ngIf="userForm.get('email')?.hasError('email')">
        Ingrese un email válido
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Contraseña</mat-label>
      <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password">
      <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
        <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
      </button>
      <mat-error *ngIf="userForm.get('password')?.hasError('required')">
        La contraseña es requerida
      </mat-error>
    </mat-form-field>
  </div>

  <!-- Campos para registro y crear/editar usuario -->
  <div *ngIf="mode !== 'login'" class="form-section">
    <!-- Nombre y Apellido -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="nombre" placeholder="Nombre">
        <mat-icon matSuffix>person</mat-icon>
        <mat-error *ngIf="userForm.get('nombre')?.hasError('required')">
          El nombre es requerido
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Apellido</mat-label>
        <input matInput formControlName="apellido" placeholder="Apellido">
        <mat-icon matSuffix>person</mat-icon>
        <mat-error *ngIf="userForm.get('apellido')?.hasError('required')">
          El apellido es requerido
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Email -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Email</mat-label>
      <input matInput type="email" formControlName="email" placeholder="tu@email.com">
      <mat-icon matSuffix>email</mat-icon>
      <mat-error *ngIf="userForm.get('email')?.hasError('required')">
        El email es requerido
      </mat-error>
      <mat-error *ngIf="userForm.get('email')?.hasError('email')">
        Ingrese un email válido
      </mat-error>
    </mat-form-field>

    <!-- Contraseña -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Contraseña</mat-label>
      <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password">
      <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
        <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
      </button>
      <mat-error *ngIf="userForm.get('password')?.hasError('required')">
        La contraseña es requerida
      </mat-error>
      <mat-error *ngIf="userForm.get('password')?.hasError('minlength')">
        La contraseña debe tener al menos 6 caracteres
      </mat-error>
    </mat-form-field>

    <!-- Datos adicionales (opcional para registro) -->
    <div *ngIf="mode === 'create' || mode === 'edit'" class="form-section">
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Edad</mat-label>
          <input matInput type="number" formControlName="edad" placeholder="Edad">
          <mat-icon matSuffix>cake</mat-icon>
          <mat-error *ngIf="userForm.get('edad')?.hasError('min')">
            La edad debe ser mayor a 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>DNI</mat-label>
          <input matInput formControlName="dni" placeholder="12345678">
          <mat-icon matSuffix>badge</mat-icon>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Teléfono</mat-label>
        <input matInput formControlName="telefono" placeholder="11 1234-5678">
        <mat-icon matSuffix>phone</mat-icon>
      </mat-form-field>

      <!-- Rol (solo para administradores) -->
      <mat-form-field appearance="outline" class="full-width" *ngIf="canSelectRole">
        <mat-label>Rol</mat-label>
        <mat-select formControlName="rol">
          <mat-option *ngFor="let role of availableRoles" [value]="role.value">
            {{role.label}}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>admin_panel_settings</mat-icon>
        <mat-error *ngIf="userForm.get('rol')?.hasError('required')">
          Seleccione un rol
        </mat-error>
      </mat-form-field>
    </div>
  </div>

  <!-- Botones de acción -->
  <div class="form-actions">
    <button 
      mat-button 
      type="button" 
      (click)="onCancel()"
      [disabled]="loading">
      Cancelar
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      type="submit"
      [disabled]="userForm.invalid || loading">
      
      <mat-icon *ngIf="loading">refresh</mat-icon>
      <span *ngIf="!loading">{{getSubmitButtonText()}}</span>
      <span *ngIf="loading">{{getLoadingText()}}</span>
    </button>
  </div>

  <!-- Información adicional -->
  <div *ngIf="mode === 'login'" class="additional-info">
    <p>¿No tienes cuenta? 
      <button mat-button color="primary" type="button" (click)="switchToRegister()">
        Regístrate aquí
      </button>
    </p>
  </div>

  <div *ngIf="mode === 'register'" class="additional-info">
    <p>¿Ya tienes cuenta? 
      <button mat-button color="primary" type="button" (click)="switchToLogin()">
        Inicia sesión
      </button>
    </p>
  </div>
</form>
